{% extends 'base.html' %}
{% block title %}Covid-19 Postcode Search - {{ postcode }}{% endblock %}
{% block head %}
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

    // Load the Visualization API and the controls package.
    // Packages for all the other charts you need will be loaded
    // automatically by the system.
    google.charts.load('current', {'packages':['corechart', 'controls', 'line']});

    // Set a callback to run when the Google Visualization API is loaded.
    google.charts.setOnLoadCallback(drawDashboard);

    function drawDashboard() {
        // Everything is loaded. Assemble your dashboard...
        var data = new google.visualization.DataTable();
      data.addColumn('date', 'Date');
      data.addColumn('number', 'Cases');

      data.addRows([
        {% for each in history %}
        {{ each }}
        {% endfor %}
      ]);

        var dashboard = new google.visualization.Dashboard(document.getElementById('dashboard_div'));

        // Create a range slider, passing some options
        var casesRangeSlider = new google.visualization.ControlWrapper({
            'controlType': 'DateRangeFilter',
            'containerId': 'filter_div',
            'options': {
            'filterColumnLabel': 'Date',
            'ui': {
                'label': "",
                'format': {pattern: "d/M/yy"},
            }
            }
        });

        var casesChart = new google.visualization.ChartWrapper({
            'chartType': 'LineChart',
            'containerId': 'chart_div',
            'options': {
                height: 300,
                legend: 'none',
                hAxis: {
                format: 'd MMM',
                gridlines : {
                    count : 14,
                    minSpacing: 80,
                    }
                },
                vAxis: {
                title: 'Total Cases',
                format: '0',
                }
            }
        });

        dashboard.bind(casesRangeSlider, casesChart);

        function resize() {
            var chart = new google.visualization.Dashboard(document.getElementById('dashboard_div'));
            chart.draw(data);
        }
        window.onload = resize();
        window.onresize = resize;


        dashboard.draw(data);
    };

    </script>

    <script type="text/javascript">

    google.charts.load('current', {'packages':['corechart', 'controls', 'line']});

    google.charts.setOnLoadCallback(drawTestDashboard);

    function drawTestDashboard() {
        var data = new google.visualization.DataTable();
      data.addColumn('date', 'Date');
      data.addColumn('number', 'Tests');
      data.addColumn('number', 'Positive');

      data.addRows([
        {% for each in testing %}
        {{ each }}
        {% endfor %}  
        
      ]);

        var test_dashboard = new google.visualization.Dashboard(document.getElementById('dashboard_test_div'));

        // Create a range slider, passing some options
        var casesRangeSlider = new google.visualization.ControlWrapper({
            'controlType': 'DateRangeFilter',
            'containerId': 'filter_test_div',
            'options': {
            'filterColumnLabel': 'Date',
            'ui': {
                'label': "",
                'format': {pattern: "d/M/yy"},
            }
            }
        });

        var casesChart = new google.visualization.ChartWrapper({
            'chartType': 'ColumnChart',
            'containerId': 'chart_test_div',
            'options': {
                height: 300,
                hAxis: {
                format: 'd MMM',
                gridlines : {
                    count : 14,
                    minSpacing: 80,
                    }
                },
                vAxis: {
                format: '0',
                scaleType: 'log',
                }
            }
        });

        test_dashboard.bind(casesRangeSlider, casesChart);

        function resize() {
            var chart = new google.visualization.Dashboard(document.getElementById('dashboard_test_div'));
            chart.draw(data);
        }
        window.onload = resize();
        window.onresize = resize;

        test_dashboard.draw(data);
    };

    </script>


{% endblock %}

{% block content %}
    <div class="container">
    <div class="row select-buttons mb-2">
        <div class="col-4 button-all">
            <form action="postcode" method = "POST" class="form-inline">
                {% if days_set == 'all' %}
                    <button class="btn btn-outline-success my-2 my-sm-0 active" type="submit" name="days" value="recall-{{ postcode }}-all">All Cases</button>
                {% else %}
                    <button class="btn btn-outline-success my-2 my-sm-0" type="submit" name="days" value="recall-{{ postcode }}-all">All Cases</button>
                {% endif %}
            </form>
        </div>
        <div class="col-4 button-fourteen">
            <form action="postcode" method = "POST" class="form-inline">
                {% if days_set == 'fourteen' %}
                    <button class="btn btn-outline-success my-2 my-sm-0 active" type="submit" name="days" value="recall-{{ postcode }}-fourteen">14 Days</button>
                {% else %}
                    <button class="btn btn-outline-success my-2 my-sm-0" type="submit" name="days" value="recall-{{ postcode }}-fourteen">14 Days</button>
                {% endif %}
            </form>
        </div>
        <div class="col-4 button-seven">
            <form action="postcode" method = "POST" class="form-inline" name="seven-days">
                {% if days_set == 'seven' %}
                    <button class="btn btn-outline-success my-2 my-sm-0 active" type="submit" name="days" value="recall-{{ postcode }}-seven">7 Days</button>
                {% else %}
                    <button class="btn btn-outline-success my-2 my-sm-0" type="submit" name="days" value="recall-{{ postcode }}-seven">7 Days</button>
                {% endif %}
            </form>
        </div>
    </div>
    </div>
    <div class="container">
        <div class="row headers mb-2">
            <div class="col-2">
            Rank
            </div>
            <div class="col-6">
            Postcode
            </div>
            <div class="col-2">
            Cases
            </div>
            <div class="col-2">
            Recent
            </div>
        </div>
    {% for each in data %}
        <div class="row rank-entry">
            <div class="col-2">
                <div class="rank-number">
                    <div class="h2">{{ each.rank }}</div>    
                </div>
            </div>

            <div class="col-6">
                <div class="postcode">
                    <div class="h2">{{ each.postcode }}</div>
                </div>
                <div class="suburbs">
                    {{ each.suburbs }}
                </div>
            </div>

            <div class="col-2">
                <div class="today-count mt-3">
                    <h3>{{each.count}}</h3>
                </div>
            </div>

            <div class="col-2">
                <div class="new-cases mt-3">
                    {{ each.count_change }}
                </div>
            </div>
        </div>
    
    <div class="row mt-2">
        <div class="col-lg-4"></div>
        <div class="col-lg-4 infection-box">
        <h5 class="infection-heading">Infection Source</h5>
        <p class="infection-p"><span class="infection-type">Overseas:</span> <span class="infection">{{ each.source.overseas }}</span></p>
        <p class="infection-p"><span class="infection-type">Interstate:</span> <span class="infection">{{ each.source.interstate }}</span></p>
        <p class="infection-p"><span class="infection-type">Locally (Known Source):</span> <span class="infection">{{ each.source.locallyacquiredcontactofaconfirmedcaseandorinaknowncluster }}</span></p>
        <p class="infection-p"><span class="infection-type">Locally (Unknown Source):</span> <span class="infection">{{ each.source.locallyacquiredcontactnotidentified }}</span></p>
        <p class="infection-p"><span class="infection-type">Under Investigation:</span> <span class="infection">{{ each.source.underinvestigation }}</span></p>
        </div>
        <div class="col-lg-4"></div>
    </div>

    <div class="row" id="dashboard_div">
        <div class="col">
      <!--Divs that will hold each control and chart-->
            <div id="chart_div"></div>
            <div class="text-center" id="filter_div"></div>
        </div>
    </div>
    
    
    </div>
    {% endfor %}

    <div class="container">
        <div class="today-count"><h3>Close Suburbs</h3></div>
        <div class="row headers mb-2">
            <div class="col-2">
            Rank
            </div>
            <div class="col-6">
            Postcode
            </div>
            <div class="col-2">
            Cases
            </div>
            <div class="col-2">
            Recent
            </div>
        </div>
    {% for each in close %}
    <div class="row rank-entry">
            <div class="col-2">
                <div class="rank-number">
                    <div class="h2">{{ each.rank }}</div>    
                </div>
            </div>

            <div class="col-6">
                <div class="postcode">
                    <div class="h2">
                    <a href = {{ url_for('postcode', location=each.postcode) }}>
                    {{ each.postcode }}
                    </a>
                    </div>
                </div>
                <div class="suburbs">
                    {{ each.suburbs }}
                </div>
            </div>

            <div class="col-2">
                <div class="today-count mt-3">
                    <h3>{{each.count}}</h3>
                </div>
            </div>

            <div class="col-2">
                <div class="new-cases mt-3">
                    {{ each.count_change }}
                </div>
            </div>
        </div>
    {% endfor %}
    <div class="row mt-5" id="dashboard_tests_div">
        <div class="col">
        <div class="today-count"><h3>Testing Results</h3></div>
      <!--Divs that will hold each control and chart-->
            <div id="chart_test_div"></div>
            <div class="text-center" id="filter_test_div"></div>
        </div>
    </div>
    <div class="contact-message mt-5">
    <p>The information on this website is updated as soon as new data is published by NSW Health which is usually once a day.  The last update was at {{ last_update }}. For feedback on the website or to suggest a feature please contact <a href="mailto:covid19nsw.stat@gmail.com">covid19nsw.stat@gmail.com</a></p>
    </div>
    </div>

{% endblock %} 